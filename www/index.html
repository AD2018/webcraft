<!doctype html>
<html ng-app="gameApp">
<head>
	<title>MadCraft</title>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" type="image/png" href="/favicon.png" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.00, maximum-scale=2.50, minimum-scale=0.75">
	<!-- Stylesheet -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <link href="style/main.css" rel="stylesheet" type="text/css">
	<link href="style/ui.css" rel="stylesheet" type="text/css">
	<!-- Third party -->
    <script src="vendors/gl-matrix-3.3.min.js" type="text/javascript"></script>
    <script src="vendors/howler.min.js" type="text/javascript"></script>
    <script src="vendors/angular.min.js"></script>
    <!--
    <script src="vendors/webgl-utils.js"></script>
    <script src="vendors/objParser.js"></script>
    -->
    <script src="js/ui/controller.js" type="module"></script>
</head>
<body oncontextmenu="return false" ng-controller="gameCtrl" ng-cloak>

	<canvas id="renderSurface" ng-click="Game.setupMousePointerIfNoOpenWindows()" style="background: #000;" width="1600" height="1200"></canvas>

    <div>

        <a href="https://discord.gg/QQw2zadu3T" target="_blank" class="btn-discord visible_in_game_menu">
            <span style="margin-right: 1em;">Discord<br>community</span>
            <img src="/media/discord.png" style="height: 2em;">
        </a>

        <h3>{{current_window.getTitle()}}</h3>

        <!-- Hello -->
        <div id="form-hello" class="form-styled" ng-if="Game && current_window.id == 'hello'">
            <div class="flex0 flex-column">
                <button class="btn" ng-click="current_window.show('login')">
                    <span>{{lang.login}}</span>
                </button>
                <button class="btn" ng-click="current_window.show('registration')">
                    <span>{{lang.registration}}</span>
                </button>
            </div>
        </div>

        <!-- Login -->
        <div id="form-login" class="form-styled animate__animated animate__fadeIn" ng-if="Game && current_window.id == 'login'">
            <div class="flex0 flex-column">
                <div class="flex0 flex-column">
                    <label>
                        {{lang.enter_your_name}}:
                        <br><input type="text" ng-model="login.form.username" my-enter="login.submit()">
                    </label>
                    <label>
                        {{lang.enter_your_password}}:
                        <br><input type="password" ng-model="login.form.password" my-enter="login.submit()">
                    </label>
                    <button class="btn" ng-click="login.submit()" ng-class="{disabled: !login.isValid()}">
                        <span>{{lang.enter}}</span>
                    </button>
                    <button class="btn" ng-click="current_window.show('hello')">
                        <span>{{lang.back}}</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Registration -->
        <div id="form-registration" class="form-styled animate__animated animate__fadeIn" ng-if="Game && current_window.id == 'registration'">
            <div class="flex0 flex-column">
                <div class="flex0 flex-column">
                    <label>
                        {{lang.enter_your_name}}:
                        <br><input type="text" ng-model="registration.form.username" my-enter="registration.submit()">
                    </label>
                    <label>
                        {{lang.enter_your_password}}:
                        <br><input type="password" ng-model="registration.form.password" my-enter="registration.submit()">
                    </label>
                    <button class="btn" ng-click="registration.submit()" ng-class="{disabled: !registration.isValid()}">
                        <span>{{lang.submit}}</span>
                    </button>
                    <button class="btn" ng-click="current_window.show('hello')">
                        <span>{{lang.back}}</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Main menu -->
        <div id="main-menu" class="flex0 flex-column animate__animated animate__fadeIn" ng-if="Game && !demoMaps.loading && login.logged">

            <!-- Main menu -->
            <div ng-show="current_window.id == 'main'" class="form-doubles">

                <form>
                    <div ng-init="mygames.load()">
                        <div ng-if="mygames.list.length > 0">
                            <h4 class="text-center">My Games:</h4>
                            <div ng-repeat="item in mygames.list track by item.id">
                                <button class="btn" ng-click="StartWorld(item.id)"><span>{{item.title}}</span></button>
                            </div>
                        </div>
                        <button class="btn" ng-click="newgame.open()">
                            <span>New game...</span>
                        </button>
                    </div>
                    <div>
                        <div ng-if="demoMaps.list.length > 0">
                            <br><br><h4 class="text-center">Showcase:</h4>
                            <div ng-if="demoMaps.loading">Loading...</div>
                            <div ng-if="!demoMaps.loading">
                                <button ng-repeat="item in demoMaps.list" class="btn" ng-click="demoMaps.run(item)" ng-class="{loading: demoMaps.map_running}"><span>{{item.title}}</span><i class="fa fa-spinner fa-spin"></i></button>
                            </div>
                        </div>
                    </div>

                    <br>
                    <div style="padding: 1em; margin-top: 1em; background-color: #ffffff20;">
                        You logged as @{{Game.username}}

                        <br><br><h4 class="text-center">Settings:</h4>
                        <!-- Skin -->
                        <button class="btn" ng-click="skin.open()">
                            <span>🙂 Change skin</span>
                        </button>
                        <!-- Texture pack -->
                        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
                            <button class="btn" ng-click="texture_pack.next()">Texture pack: {{texture_pack.getCurrent().name}}</button>
                            <!-- <br>
                            <label>Texture pack</label>
                            <div>
                                <div ng-repeat="tp in texture_pack.list"><label for="input-texture_pack-{{tp.id}}"><input type="radio" id="input-texture_pack-{{tp.id}}" ng-model="settings.form.texture_pack" value="{{tp.value}}" style="width: 20px; height: 20px; margin-right: 10px;"></input> {{tp.name}}</label></div>
                            </div> -->
                        </div>
                        <!-- Generate mipmap -->
                        <div style="display: flex; align-items: center; justify-content: center; margin-top: 1em;">
                            <input type="checkbox" id="input-mipmap" ng-model="settings.form.mipmap" style="width: 20px; height: 20px; margin-right: 10px;"></input>
                            <label for="input-mipmap">Generate mipmap</label>
                        </div>

                        <br><br>
                        <button class="btn" ng-click="App.logout()">
                            <span>Logout</span>
                        </button>
                    </div>
                </form>

                <form>
                    <h4 class="text-center">Commands:</h4>
                    <div style="font-size: 14px;">
                        <strong>WASD</strong> - Moving
                        <br><strong>F2</strong> - Save
                        <br><strong>F4</strong> - Set position as spawnpoint
                        <br><strong>R</strong> - Respawn
                        <br><strong>J</strong> - Big jump
                        <br><strong>0-9</strong> - Select block
                        <br><strong>Left mouse button</strong> - Remove block
                        <br><strong>Right mouse button</strong> - Set block
                        <br><strong>Mouse whell</strong> - Clone block under cursor
                        <br><strong>Ctrl, Double W</strong> - Running
                        <br><br>Other:
                        <br><strong>F4 + Shift</strong> - Draw all blocks near player
                        <br><strong>F7</strong> - Draw player model at current pos
                        <br><strong>F8</strong> - Teleport to random location
                        <br><strong>F9</strong> - Night (toggle)
                        <br><strong>F10</strong> - Change game mode
                    </div>

                    <br>
                    <br>
                    <h4 class="text-center">Thank you:</h4>
                    <div style="font-size: 14px;">
                        <strong>128 texture pack</strong> - <a href="https://gitlab.com/drummyfish/minetest-texturepack" style="color: #2196f3;">@drummyfish</a>
                    </div>

                    
                </form>

            </div>

            <!-- Change skin -->
            <div ng-show="current_window.id == 'skin'" style="text-align: center;">
                SELECT SKIN:
                <br><br>
                <div ng-repeat="k in skin.list">
                    <img ng-src="/media/skins/preview/{{k.id}}.png" ng-if="$index == skin.index" style="height: 350px;">
                </div>
                <div>
                    <div style="font-size: 14px; visibility: hidden;">
                        <br><strong>Mouse whell</strong> - Clone block under cursor
                    </div>
                </div>
                <div style="padding-bottom: 1em;">
                    {{skin.index + 1}} / {{skin.list.length}}
                </div>
                <div style="display: flex;">
                    <button class="btn" ng-click="skin.prev()"><span>⬅️ Prev</span></button>
                    <button class="btn" ng-click="skin.next()"><span>Next ➡️</span></button>
                </div>
                <button class="btn" ng-click="skin.save()">
                    <span>✅ Save</span>
                </button>
                <button class="btn" ng-click="skin.close()">
                    <span>❌ Cancel</span>
                </button>
            </div>

            <!-- Loading -->
            <div ng-show="current_window.id == 'loading'" style="text-align: center;">
                Loading...
            </div>

            <!-- New game -->
            <div ng-show="current_window.id == 'newgame'" style="text-align: center;">
                NEW GAME:
                <br><br>
                <div>
                    Name:
                    <br><input type="text" ng-model="newgame.form.title" autofocus>
                </div>
                <div>
                    Seed:
                    <br><input type="text" ng-model="newgame.form.seed" autofocus>
                </div>
                <div>
                    <button class="btn" ng-click="generators.next()">
                        <span>Тип мира: {{generators.getCurrent().title}}</span>
                    </button>
                </div>
                <button class="btn" ng-click="newgame.submit()" ng-class="{disabled: !newgame.form.title.trim()}">
                    <span>✅ Create</span>
                </button>
                <button class="btn" ng-click="newgame.close()">
                    <span>❌ Cancel</span>
                </button>
            </div>

        </div>

        <!--
        <div style="position: absolute; right: 1em; bottom: 1em; z-index: 5000; background-color: #00000033; font-size: 10px; padding: 1em; border-radius: 1em;">
            <input type="range" min="-1.5707" max="1.5707" step=".01" value="0" ng-model="sunDir.value.x" ng-change="sunDir.apply()">
            <br><input type="range" min="-1.5707" max="1.5707" step=".01" value="0" ng-model="sunDir.value.y" ng-change="sunDir.apply()">
            <br><input type="range" min="-1.5707" max="1.5707" step=".01" value="0" ng-model="sunDir.value.z" ng-change="sunDir.apply()">
            <br><input ng-value="sunDir.getValue()">
        </div>
        -->

    </div>

</body>
</html>
